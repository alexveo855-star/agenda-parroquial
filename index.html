<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Parroquial Digital</title>
    
    <link href="public/output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3b82f6; /* blue-500 */
            --primary-hover: #2563eb; /* blue-600 */
            --primary-light: #eff6ff; /* blue-50 */
            --secondary-color: #e5e7eb; /* gray-200 */
            --secondary-hover: #d1d5db; /* gray-300 */
            --text-primary: #1f2937; /* gray-800 */
            --text-secondary: #4b5563; /* gray-600 */
            --background-light: #f9fafb; /* gray-50 */
            --background-white: #ffffff;
            --border-color: #e5e7eb; /* gray-200 */
            --danger-color: #ef4444; /* red-500 */
            --danger-hover: #dc2626; /* red-600 */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-light);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .calendar-grid {
            grid-template-columns: repeat(7, minmax(0, 1fr));
        }
        
        .calendar-day {
            min-height: 110px;
        }
        
        .event-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db; /* gray-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; /* gray-400 */
        }
        
        .form-input {
            @apply w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 transition;
        }
        
        .details-section {
            display: none;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.active {
            display: block;
        }

        .btn {
             @apply font-semibold py-2 px-4 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2;
        }
        .btn-primary {
            @apply bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500;
        }
        .btn-secondary {
             @apply bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400;
        }
        .btn-danger {
            @apply bg-red-600 text-white hover:bg-red-700 focus:ring-red-500;
        }
        .btn-disabled {
            @apply bg-gray-200 text-gray-400 cursor-not-allowed;
        }
        .main-nav-btn {
            @apply flex items-center gap-2 text-gray-600 bg-transparent hover:bg-blue-50 hover:text-blue-600 font-semibold py-2 px-3 rounded-full text-sm transition-colors duration-200;
        }
        .main-nav-btn.active {
            @apply bg-blue-100 text-blue-600;
        }
        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="text-gray-800 bg-gray-50">

    <div id="app" class="flex flex-col h-screen">
        <header class="bg-white p-3 flex items-center justify-between border-b border-gray-200 gap-6 w-full">
            <div class="flex items-center gap-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                </svg>
                <h1 class="text-2xl font-bold text-gray-800 flex-shrink-0">Asistente Parroquial</h1>
            </div>

            <div class="flex items-center gap-4">
                <nav class="flex items-center gap-2">
                    <button id="open-directory-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-2 0v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm5 4a1 1 0 100 2h2a1 1 0 100-2H9z" clip-rule="evenodd" /> </svg>
                        <span>Directorio</span>
                    </button>
                    <button id="open-agenda-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /> </svg>
                        <span>Agenda</span>
                    </button>
                    <button id="open-anuncios-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 3a1 1 0 00-1.447-.894L8.763 6H5a1 1 0 00-1 1v6a1 1 0 001 1h3.763l7.79 3.894A1 1 0 0018 17V3zM16 7.938V12.06l-2.764-1.382L16 7.938zM5 8h2v4H5V8z" clip-rule="evenodd" />
                        </svg>
                        <span>Anuncios</span>
                    </button>
                </nav>
                <div class="w-px h-6 bg-gray-300"></div>
                <nav class="flex items-center gap-2">
                    <button id="open-revisiones-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /> </svg>
                        <span>Revisiones</span>
                    </button>
                    <button id="open-habilidades-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /> </svg>
                        <span>Habilidades</span>
                    </button>
                    <button id="open-tareas-btn" class="main-nav-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a1 1 0 011-1h14a1 1 0 110 2H3a1 1 0 01-1-1z" /> </svg>
                        <span>Tareas</span>
                    </button>
                </nav>
                <div id="current-user-display" class="text-sm text-gray-700 font-semibold hidden bg-gray-100 px-3 py-1 rounded-full items-center gap-2"></div>
            </div></header>
        
        <div class="flex flex-col lg:flex-row flex-grow overflow-hidden">
            <aside class="w-full lg:w-80 bg-gray-100 p-6 flex flex-col space-y-6 border-b lg:border-r border-gray-200 overflow-y-auto">
                <div class="text-center bg-white p-4 rounded-xl shadow-lg">
                    <div id="clock" class="text-3xl font-semibold text-gray-800"></div>
                    <div id="date" class="text-lg text-gray-500"></div>
                </div>

                <div class="flex-grow flex flex-col bg-white p-4 rounded-xl shadow-lg overflow-hidden">
                    <h2 class="text-xl font-semibold mb-3 text-gray-700">Próximos Recordatorios</h2>
                    <div id="reminders-list" class="space-y-2 overflow-y-auto pr-2 max-h-40 lg:max-h-full">
                        </div>
                </div>
                
                 <div class="bg-white p-4 rounded-xl shadow-lg">
                    <h2 class="text-lg font-semibold mb-3 text-gray-700">Copia de Seguridad</h2>
                    <div class="flex space-x-2">
                        <button id="export-data-btn" class="btn btn-secondary w-full text-sm">Exportar Datos</button>
                        <button id="import-data-btn" class="btn btn-secondary w-full text-sm">Importar Datos</button>
                        <input type="file" id="import-file-input" class="hidden" accept=".json">
                    </div>
                </div>
            </aside>

            <main class="flex-1 p-4 sm:p-6 lg:p-8 flex flex-col overflow-y-auto">
                <div class="bg-white rounded-xl shadow-lg flex-grow flex flex-col">
                    <header class="flex flex-col sm:flex-row items-center justify-between p-4 border-b border-gray-200 gap-4 sm:gap-2">
                        <div class="flex items-center space-x-2">
                            <h2 id="month-year" class="text-xl font-bold text-gray-800"></h2>
                            <div class="flex items-center">
                                 <button id="prev-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                                     <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                 </button>
                                 <button id="next-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                                     <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                 </button>
                            </div>
                             <button id="today-btn" class="btn btn-secondary text-sm">Hoy</button>
                        </div>
                    </header>
                    
                    <div class="calendar-grid grid border-b border-gray-200">
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Dom</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Lun</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Mar</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Mié</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Jue</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Vie</div>
                        <div class="text-center font-semibold p-2 text-gray-500 text-xs sm:text-sm">Sáb</div>
                    </div>
                    <div id="calendar-days" class="calendar-grid grid flex-grow">
                        </div>
                </div>
            </main>
        </div>
    </div>

    <div id="day-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-lg flex flex-col max-h-[90vh] transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 id="modal-date" class="text-lg font-semibold text-gray-800"></h3>
                <button id="close-modal-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div class="p-6 overflow-y-auto space-y-6">
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Recordatorios del Día</h4>
                    <div id="modal-events-list" class="space-y-2"></div>
                    <form id="add-event-form" class="mt-4 flex space-x-2">
                        <input type="text" id="event-input" placeholder="Añadir nuevo recordatorio..." class="form-input flex-grow">
                        <button type="submit" class="btn btn-primary">Añadir</button>
                    </form>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700 mb-2">Notas del Día</h4>
                    <textarea id="notes-textarea" rows="6" class="form-input" placeholder="Escribe tus notas aquí..."></textarea>
                    <div id="notes-modifier-info" class="text-xs text-right text-gray-500 mt-1 h-4"></div>
                </div>
            </div>
            <footer class="p-4 bg-gray-50 border-t border-gray-200 text-right">
                <button id="save-notes-btn" class="btn btn-primary">Guardar Notas</button>
            </footer>
        </div>
    </div>
    
    <div id="manual-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-4xl flex flex-col max-h-[90vh] transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 id="manual-modal-title" class="text-lg font-semibold text-gray-800"></h3>
                <button id="close-manual-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div id="manual-content" class="p-6 overflow-y-auto flex-grow bg-gray-50">
                <div id="tab-content-agenda" class="tab-pane"></div>
                <div id="tab-content-revisiones" class="tab-pane space-y-6"></div>
                <div id="tab-content-habilidades" class="tab-pane">
                    <textarea id="manual-habilidades-text" class="w-full h-full p-3 border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" style="min-height: 65vh;"></textarea>
                </div>
                <div id="tab-content-tareas" class="tab-pane"></div>
            </div>
        </div>
    </div>
    
    <div id="directory-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-5xl flex flex-col max-h-[90vh] transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-800">Directorio Parroquial</h3>
                <button id="close-directory-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div class="flex-grow flex md:flex-row flex-col overflow-hidden">
                <div class="w-full md:w-1/3 p-6 border-b md:border-b-0 md:border-r border-gray-200 bg-gray-50 overflow-y-auto">
                    <h4 id="contact-form-title" class="text-xl font-semibold mb-4 text-gray-700">Añadir Contacto</h4>
                    <form id="add-contact-form" class="space-y-4">
                        <input type="hidden" id="contact-id">
                        <div>
                            <label for="nombre" class="block text-sm font-medium text-gray-600">Nombre Completo</label>
                            <input type="text" name="nombre" id="nombre" class="form-input mt-1" required>
                        </div>
                        <div>
                            <label for="domicilio" class="block text-sm font-medium text-gray-600">Domicilio</label>
                            <input type="text" name="domicilio" id="domicilio" class="form-input mt-1">
                        </div>
                        <div>
                            <label for="telefono" class="block text-sm font-medium text-gray-600">Teléfono</label>
                            <input type="tel" name="telefono" id="telefono" class="form-input mt-1">
                        </div>
                         <div>
                            <label for="email" class="block text-sm font-medium text-gray-600">Correo Electrónico</label>
                            <input type="email" name="email" id="email" class="form-input mt-1">
                        </div>
                        <div>
                            <label for="tipoSangre" class="block text-sm font-medium text-gray-600">Tipo de Sangre</label>
                            <input type="text" name="tipoSangre" id="tipoSangre" class="form-input mt-1">
                        </div>
                        <div>
                            <label for="alergias" class="block text-sm font-medium text-gray-600">Alergias</label>
                            <textarea name="alergias" id="alergias" rows="2" class="form-input mt-1"></textarea>
                        </div>
                        <div>
                            <label for="enfermedades" class="block text-sm font-medium text-gray-600">Enfermedades</label>
                            <textarea name="enfermedades" id="enfermedades" rows="2" class="form-input mt-1"></textarea>
                        </div>
                         <div>
                            <label for="medicamentos" class="block text-sm font-medium text-gray-600">Medicamentos en Uso</label>
                            <textarea name="medicamentos" id="medicamentos" rows="2" class="form-input mt-1"></textarea>
                        </div>
                        <div class="flex space-x-2 pt-2">
                             <button type="submit" class="btn btn-primary w-full">Guardar</button>
                             <button type="button" id="clear-contact-form" class="btn btn-secondary w-full">Nuevo</button>
                        </div>
                    </form>
                </div>
                <div class="w-full md:w-2/3 p-6 flex flex-col overflow-hidden">
                     <input type="text" id="search-contact-input" placeholder="Buscar por nombre..." class="form-input mb-4">
                     <div id="directory-list" class="flex-grow overflow-y-auto space-y-3 pr-2">
                     </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="add-task-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md flex flex-col transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b border-gray-200"><h3 id="add-task-title" class="text-lg font-semibold text-gray-800">Añadir Tarea al Calendario</h3></header>
            <form id="add-task-form" class="p-6 space-y-4">
                <div><label for="task-details" class="block text-sm font-medium text-gray-600">Tarea y Comentarios</label><textarea id="task-details" rows="3" class="form-input mt-1" required></textarea></div>
                <div class="grid grid-cols-2 gap-4">
                    <div><label for="task-date" class="block text-sm font-medium text-gray-600">Fecha</label><input type="date" id="task-date" class="form-input mt-1" required></div>
                    <div><label for="task-time" class="block text-sm font-medium text-gray-600">Hora</label><input type="time" id="task-time" class="form-input mt-1"></div>
                </div>
            </form>
            <footer class="p-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-2">
                <button id="close-task-modal-btn" type="button" class="btn btn-secondary">Cancelar</button>
                <button id="save-task-btn" type="button" class="btn btn-primary">Guardar Tarea</button>
            </footer>
        </div>
    </div>

    <div id="reason-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-lg transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b"><h3 class="text-lg font-semibold text-gray-800">Tareas Incompletas</h3></header>
            <div class="p-6">
                <p class="mb-4 text-gray-600">Por favor, indica por qué las siguientes tareas no se completaron:</p>
                <form id="reason-form" class="space-y-4 max-h-80 overflow-y-auto"></form>
            </div>
            <footer class="p-4 bg-gray-50 flex justify-end">
                <button id="save-reasons-btn" class="btn btn-primary">Guardar y Finalizar</button>
            </footer>
        </div>
    </div>

    <div id="stats-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-2xl flex flex-col max-h-[90vh] transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b flex justify-between items-center">
                <h3 id="stats-title" class="text-lg font-semibold text-gray-800">Estadísticas de Revisiones</h3>
                <button id="close-stats-btn" class="p-2 rounded-full hover:bg-gray-100">&times;</button>
            </header>
            <div id="stats-content" class="p-6 overflow-y-auto"></div>
        </div>
    </div>
    
    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-sm transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-6 text-center">
                <h3 class="text-lg font-semibold mb-2 text-gray-800">Confirmar Acción</h3>
                <p id="confirm-modal-text" class="text-gray-600 mb-6"></p>
                <div class="flex justify-center space-x-3">
                    <button id="confirm-modal-cancel-btn" class="btn btn-secondary w-full">Cancelar</button>
                    <button id="confirm-modal-confirm-btn" class="btn btn-danger w-full">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center p-4 z-[100]">
        <div class="bg-white p-8 rounded-2xl shadow-lg text-center w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Iniciar Sesión</h2>
            <p class="text-gray-600 mb-6">Usa tu cuenta de Google para continuar.</p>
            <button id="google-login-btn" class="mt-4 w-full h-12 rounded-lg flex justify-center items-center font-medium gap-3 border border-gray-300 bg-white cursor-pointer transition-all duration-200 ease-in-out hover:border-blue-500 hover:shadow-md">
                <svg xml:space="preserve" style="enable-background:new 0 0 512 512;" viewBox="0 0 512 512" y="0px" x="0px" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" id="Layer_1" width="20" version="1.1">
                    <path d="M113.47,309.408L95.648,375.94l-65.139,1.378C11.042,341.211,0,299.9,0,256 c0-42.451,10.324-82.483,28.624-117.732h0.014l57.992,10.632l25.404,57.644c-5.317,15.501-8.215,32.141-8.215,49.456 C103.821,274.792,107.225,292.797,113.47,309.408z" style="fill:#FBBB00;"></path>
                    <path d="M507.527,208.176C510.467,223.662,512,239.655,512,256c0,18.328-1.927,36.206-5.598,53.451 c-12.462,58.683-45.025,109.925-90.134,146.187l-0.014-0.014l-73.044-3.727l-10.338-64.535 c29.932-17.554,53.324-45.025,65.646-77.911h-136.89V208.176h138.887L507.527,208.176L507.527,208.176z" style="fill:#518EF8;"></path>
                    <path d="M416.253,455.624l0.014,0.014C372.396,490.901,316.666,512,256,512 c-97.491,0-182.252-54.491-225.491-134.681l82.961-67.91c21.619,57.698,77.278,98.771,142.53,98.771 c28.047,0,54.323-7.582,76.87-20.818L416.253,455.624z" style="fill:#28B446;"></path>
                    <path d="M419.404,58.936l-82.933,67.896c-23.335-14.586-50.919-23.012-80.471-23.012 c-66.729,0-123.429,42.957-143.965,102.724l-83.397-68.276h-0.014C71.23,56.123,157.06,0,256,0 C318.115,0,375.068,22.126,419.404,58.936z" style="fill:#F14336;"></path>
                </svg>
                <span>Iniciar sesión con Google</span>
            </button>
            <p id="login-error" class="text-red-500 text-sm mt-4"></p>
        </div>
    </div>

    <div id="anuncios-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl flex flex-col max-h-[90vh] transform transition-all duration-300 scale-95 opacity-0">
            <header class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-gray-800">Anuncios Parroquiales</h3>
                <button id="close-anuncios-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </header>
            <div class="p-6 flex-grow overflow-y-auto space-y-6">
                <form id="add-anuncio-form" class="space-y-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hidden">
                    <div>
                        <label for="anuncio-title" class="block text-sm font-medium text-gray-600">Título del Anuncio</label>
                        <input type="text" id="anuncio-title" class="form-input mt-1" required>
                    </div>
                    <div>
                        <label for="anuncio-content" class="block text-sm font-medium text-gray-600">Contenido del Anuncio</label>
                        <textarea id="anuncio-content" rows="4" class="form-input mt-1" required></textarea>
                    </div>
                    <div class="text-right">
                        <button type="submit" class="btn btn-primary">Publicar Anuncio</button>
                    </div>
                </form>
                <div id="anuncios-list" class="space-y-4">
                    </div>
            </div>
        </div>
    </div>


    <script src="firebase-config.js"></script>
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, addDoc, updateDoc, deleteDoc, onSnapshot, collection, query, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', () => {
            // Firebase State
            let db, auth, appId;
            let listeners = [];

            // App State
            let currentUser = null;
            let currentUserIsParroco = false;
            let currentDate = new Date();
            let data = {
                calendar: {}, directory: [], agenda: [], specificTasks: [], announcements: [],
                manual: { habilidades: '' }, revisionTasks: getInitialRevisionTasks(), revisionChecklists: {}
            }; 
            let selectedDateKey = null;

            // DOM Elements
            const loginModal = document.getElementById('login-modal');
            const currentUserDisplay = document.getElementById('current-user-display');
            const allModals = document.querySelectorAll('.fixed.inset-0');
            const clockEl = document.getElementById('clock');
            const dateEl = document.getElementById('date');
            const monthYearEl = document.getElementById('month-year');
            const calendarDaysEl = document.getElementById('calendar-days');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const todayBtn = document.getElementById('today-btn');
            const remindersListEl = document.getElementById('reminders-list');
            const openDirectoryBtn = document.getElementById('open-directory-btn');
            const openAgendaBtn = document.getElementById('open-agenda-btn');
            const openRevisionesBtn = document.getElementById('open-revisiones-btn');
            const openHabilidadesBtn = document.getElementById('open-habilidades-btn');
            const openTareasBtn = document.getElementById('open-tareas-btn');
            const openAnunciosBtn = document.getElementById('open-anuncios-btn');
            const navButtons = document.querySelectorAll('.main-nav-btn');
            
            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            const dayNames = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];

            const liturgicalDates2025 = ["2025-01-01", "2025-01-06", "2025-03-05", "2025-04-13", "2025-04-17", "2025-04-18", "2025-04-19", "2025-04-20", "2025-05-29", "2025-06-08", "2025-06-22", "2025-06-29", "2025-08-15", "2025-11-01", "2025-11-23", "2025-12-08", "2025-12-12", "2025-12-25"];

            function getInitialRevisionTasks() {
                return {
                    before: [
                        { id: 'rt-b-1', text: 'Verificar limpieza y orden del presbiterio y la sacristía.' },
                        { id: 'rt-b-2', text: 'Preparar los vasos sagrados (cáliz, patena, copones).' },
                    ],
                    during: [ { id: 'rt-d-1', text: 'Asistir al sacerdote en lo que necesite discretamente.' } ],
                    after: [ { id: 'rt-a-1', text: 'Reservar el Santísimo Sacramento en el sagrario.' } ]
                };
            }

            function setActiveNav(button) {
                navButtons.forEach(btn => btn.classList.remove('active'));
                if (button) {
                    button.classList.add('active');
                }
            }

            // --- Modal Manager ---
            const modalManager = {
                open: (modalEl, navBtn) => {
                    setActiveNav(navBtn);
                    modalEl.classList.remove('hidden');
                    modalEl.classList.add('flex');
                    setTimeout(() => {
                        const innerModal = modalEl.querySelector('.transform');
                        if (innerModal) innerModal.classList.remove('scale-95', 'opacity-0');
                    }, 10);
                },
                close: (modalEl) => {
                    setActiveNav(null);
                    const innerModal = modalEl.querySelector('.transform');
                    if (innerModal) innerModal.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => modalEl.classList.add('hidden'), 300);
                }
            };
            
            allModals.forEach(modal => {
                const closeBtn = modal.querySelector('[id^="close-"]');
                if (closeBtn) closeBtn.addEventListener('click', () => modalManager.close(modal));
                modal.addEventListener('click', (e) => { if (e.target === modal) modalManager.close(modal); });
            });

            // --- Authentication & Initialization ---
            async function initFirebase() {
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                
                let firebaseConfig;
                if (typeof __firebase_config !== 'undefined' && __firebase_config !== '{}') {
                    firebaseConfig = JSON.parse(__firebase_config);
                } else {
                    document.body.innerHTML = `
                        <div class="p-8 text-center text-orange-600 bg-orange-50 min-h-screen flex items-center justify-center">
                            <div>
                                <h1 class="text-2xl font-bold mb-4">Configuración de Firebase no encontrada</h1>
                                <p class="mb-2">Asegúrate de que <code>firebase-config.js</code> exista y contenga tus credenciales.</p>
                                <p>Si ya lo has hecho, es posible que necesites refrescar la página.</p>
                            </div>
                        </div>`;
                    return;
                }
                
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "AQUI_VA_TU_API_KEY") {
                    document.body.innerHTML = `
                        <div class="p-8 text-center text-orange-600 bg-orange-50 min-h-screen flex items-center justify-center">
                            <div>
                                <h1 class="text-2xl font-bold mb-4">Configuración Requerida</h1>
                                <p class="mb-2">Para utilizar esta aplicación, necesitas conectarla a tu propio proyecto de Firebase.</p>
                                <p>Por favor, <strong>edita el código fuente de este archivo HTML</strong> y sigue las instrucciones dentro de la función <code>initFirebase</code> para añadir tu configuración.</p>
                            </div>
                        </div>`;
                    return;
                }
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        const isParroco = user.email === 'alexveo855@gmail.com';
                        const userName = isParroco ? 'Administrador' : user.displayName;
                        handleLoginSuccess(userName, isParroco);
                    } else {
                        handleLogout();
                    }
                });
            }

            document.getElementById('google-login-btn').addEventListener('click', async () => {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Error signing in with Google:", error);
                    const loginError = document.getElementById('login-error');
                    if (loginError) loginError.textContent = "Error al iniciar sesión con Google.";
                }
            });
            
            function handleLoginSuccess(userName, isParroco) {
                currentUser = userName;
                currentUserIsParroco = isParroco;
                
                currentUserDisplay.innerHTML = `<span>Usuario: <strong>${currentUser}</strong></span><button id="logout-btn" class="text-xs text-blue-600 hover:underline ml-2">(Salir)</button>`;
                currentUserDisplay.classList.remove('hidden');
                currentUserDisplay.classList.add('flex');
                modalManager.close(loginModal);

                document.getElementById('logout-btn').addEventListener('click', async () => {
                    await signOut(auth);
                });
                
                setupFirestoreListeners();
            }

            function handleLogout() {
                modalManager.open(loginModal);
                if (listeners.length > 0) {
                    listeners.forEach(unsub => unsub());
                    listeners = [];
                }
                currentUserDisplay.classList.add('hidden');
            }
            
            // --- Firestore Path Helpers ---
            function getCollectionRef(name) {
                return collection(db, `artifacts/${appId}/public/data/${name}`);
            }
            function getDocRef(collectionName, docId) {
                return doc(db, `artifacts/${appId}/public/data/${collectionName}/${docId}`);
            }

            // --- Firestore Listeners ---
            function setupFirestoreListeners() {
                if (listeners.length > 0) {
                    listeners.forEach(unsub => unsub());
                    listeners = [];
                }
                const collectionsToListen = ['calendar', 'directory', 'agenda', 'specificTasks', 'revisionChecklists', 'announcements'];
                collectionsToListen.forEach(name => {
                    const q = query(getCollectionRef(name));
                    const unsub = onSnapshot(q, (querySnapshot) => {
                        if (name === 'calendar' || name === 'revisionChecklists') {
                            data[name] = {};
                            querySnapshot.forEach(doc => { data[name][doc.id] = doc.data(); });
                        } else {
                             data[name] = querySnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));
                        }
                        // Trigger relevant UI updates
                        if (name === 'calendar') { renderCalendar(); updateRemindersList(); }
                        if (name === 'directory') { renderDirectory(); }
                        if (name === 'agenda') { renderAgenda(); }
                        if (name === 'specificTasks') { renderSpecificTasks(); }
                        if (name === 'announcements') { renderAnuncios(); }
                    }, (error) => console.error(`Error listening to ${name}:`, error));
                    listeners.push(unsub);
                });
            }
            
            // --- Clock & Date ---
            function updateClock() {
                const now = new Date();
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                clockEl.textContent = `${hours}:${minutes}:${seconds}`;
                dateEl.textContent = `${dayNames[now.getDay()]}, ${now.getDate()} de ${monthNames[now.getMonth()]} de ${now.getFullYear()}`;
            }

            // --- Calendar Logic ---
            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearEl.textContent = `${monthNames[month]} ${year}`;
                calendarDaysEl.innerHTML = '';
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarDaysEl.innerHTML += `<div class="border-r border-b border-gray-200 bg-gray-50"></div>`;
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const today = new Date();
                    const isToday = year === today.getFullYear() && month === today.getMonth() && day === today.getDate();
                    
                    let dayCellHTML = `<div class="calendar-day relative p-2 border-r border-b border-gray-200 cursor-pointer hover:bg-gray-100 transition-colors flex flex-col" data-date="${dateKey}">`;
                    dayCellHTML += `<span class="text-sm ${isToday ? 'bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center font-semibold' : ''}">${day}</span>`;

                    if (data.calendar[dateKey] && data.calendar[dateKey].events && data.calendar[dateKey].events.length > 0) {
                        dayCellHTML += '<div class="flex flex-wrap gap-1 mt-1">';
                        data.calendar[dateKey].events.slice(0, 3).forEach(() => {
                            dayCellHTML += '<div class="event-dot bg-blue-500"></div>';
                        });
                        dayCellHTML += '</div>';
                    }
                    dayCellHTML += `</div>`;
                    calendarDaysEl.innerHTML += dayCellHTML;
                }
            }
            
            function updateRemindersList() {
                remindersListEl.innerHTML = '';
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const upcomingEvents = [];
                for (let i = 0; i < 30; i++) {
                    const checkDate = new Date(today);
                    checkDate.setDate(today.getDate() + i);
                    const dateKey = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
                    if (data.calendar[dateKey] && data.calendar[dateKey].events) {
                        data.calendar[dateKey].events.forEach(event => {
                            const eventText = typeof event === 'object' ? event.text : event;
                            upcomingEvents.push({ date: checkDate, text: eventText });
                        });
                    }
                }
                 if (upcomingEvents.length === 0) {
                     remindersListEl.innerHTML = '<p class="text-gray-500 italic">No hay recordatorios próximos.</p>';
                     return;
                 }
                upcomingEvents.sort((a,b) => a.date - b.date);
                upcomingEvents.slice(0, 10).forEach(event => {
                    const item = document.createElement('div');
                    item.className = 'bg-white p-2 rounded-lg shadow border border-gray-200';
                    item.innerHTML = `<p class="font-medium text-gray-800 text-sm">${event.text}</p><p class="text-xs text-gray-500">${event.date.getDate()} de ${monthNames[event.date.getMonth()]}</p>`;
                    remindersListEl.appendChild(item);
                });
            }

            function renderDirectory() {
                const directoryListEl = document.getElementById('directory-list');
                if (!directoryListEl) return;
                const searchTerm = document.getElementById('search-contact-input').value.toLowerCase();
                const filteredDirectory = (data.directory || []).filter(c => c.nombre && c.nombre.toLowerCase().includes(searchTerm));
                
                directoryListEl.innerHTML = filteredDirectory.length === 0 ? '<p class="text-gray-500 italic text-center mt-4">No se encontraron contactos.</p>' : filteredDirectory.map(contact => {
                    const canEdit = currentUserIsParroco || currentUser === contact.createdBy;
                    const editButton = `<button class="edit-contact-btn text-sm ${canEdit ? 'text-blue-600 hover:underline' : 'text-gray-400 cursor-not-allowed'}" ${!canEdit ? 'disabled' : ''}>Editar</button>`;
                    const deleteButton = `<button class="delete-contact-btn text-sm ${canEdit ? 'text-red-600 hover:underline' : 'text-gray-400 cursor-not-allowed'}" ${!canEdit ? 'disabled' : ''}>Eliminar</button>`;
                    const createdByText = contact.createdBy ? `Creado por: ${contact.createdBy}` : '';
                    let modifiedByText = '';
                    if (contact.lastModifiedBy) {
                        const modDate = new Date(contact.modifiedAt).toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });
                        modifiedByText = ` | Mod. por: ${contact.lastModifiedBy} (${modDate})`;
                    }
                    
                    return `<div class="p-4 border border-gray-200 rounded-lg bg-white shadow transition-shadow hover:shadow-md" data-id="${contact.id}"><div class="flex justify-between items-start"><div><p class="font-bold text-lg text-gray-800">${contact.nombre}</p><p class="text-sm text-gray-500">${contact.telefono || 'Sin teléfono'}</p></div><div class="flex items-center space-x-3 flex-shrink-0">${editButton}${deleteButton}</div></div><div class="text-xs text-gray-400 mt-2">${createdByText}${modifiedByText}</div><div class="details-section mt-3 pt-3 border-t border-gray-200 space-y-1 text-sm"><p><strong>Domicilio:</strong> ${contact.domicilio || 'N/A'}</p></div><button class="toggle-details-btn text-sm text-blue-500 hover:underline mt-2">Ver más detalles</button></div>`;
                }).join('');
            }
            
            function renderAgenda() {
                const agendaListEl = document.getElementById('manual-modal')?.querySelector('#agenda-list');
                if (!agendaListEl) return;
                const sortedAgenda = [...(data.agenda || [])].sort((a, b) => new Date(a.date) - new Date(b.date));
                agendaListEl.innerHTML = sortedAgenda.length === 0 ? '<p class="text-gray-500 italic text-center mt-4">No hay eventos en la agenda.</p>' : sortedAgenda.map(item => {
                    const itemDate = new Date(item.date);
                    const formattedDate = `${dayNames[itemDate.getDay()]} ${itemDate.getDate()} de ${monthNames[itemDate.getMonth()]} - ${String(itemDate.getHours()).padStart(2,'0')}:${String(itemDate.getMinutes()).padStart(2,'0')} hs`;
                    
                    const canEdit = currentUserIsParroco || currentUser === item.createdBy;
                    const editButton = `<button data-id="${item.id}" class="edit-agenda-btn text-sm ${canEdit ? 'text-blue-600 hover:underline' : 'text-gray-400 cursor-not-allowed'}" ${!canEdit ? 'disabled' : ''}>Editar</button>`;
                    const deleteButton = `<button data-id="${item.id}" data-activity="${item.activity}" class="delete-agenda-btn text-sm ${canEdit ? 'text-red-600 hover:underline' : 'text-gray-400 cursor-not-allowed'}" ${!canEdit ? 'disabled' : ''}>Eliminar</button>`;
                    const createdBy = item.createdBy ? `<span class="text-xs text-gray-400">Creado por: ${item.createdBy}</span>` : '';
                    const modifiedBy = item.lastModifiedBy ? `<span class="text-xs text-gray-400 ml-2">| Mod. por: ${item.lastModifiedBy}</span>` : '';

                    return `<div class="p-4 border border-gray-200 rounded-lg bg-white shadow"><div class="flex justify-between items-start"><div><p class="font-bold text-md text-blue-700">${item.activity}</p><p class="text-sm font-semibold text-gray-600">${formattedDate}</p><p class="text-sm text-gray-500">${item.place || 'Lugar no especificado'}</p></div><div class="flex space-x-2 flex-shrink-0">${editButton}${deleteButton}</div></div><div class="mt-3 pt-3 border-t border-gray-200 text-sm text-gray-700 space-y-1"><p><strong>Contacto:</strong> ${item.contact || 'N/A'}</p><p><strong>Notas:</strong> ${item.notes || 'N/A'}</p></div><div class="mt-2 pt-2 border-t border-gray-100">${createdBy}${modifiedBy}</div></div>`;
                }).join('');
            }

            function renderSpecificTasks() { /* ... similar logic to renderAgenda/Directory ... */ }

            // --- Announcements Logic ---
            function renderAnuncios() {
                const anunciosListEl = document.getElementById('anuncios-list');
                const addAnuncioForm = document.getElementById('add-anuncio-form');
                if (!anunciosListEl || !addAnuncioForm) return;

                // Show form only for Parroco
                if (currentUserIsParroco) {
                    addAnuncioForm.classList.remove('hidden');
                } else {
                    addAnuncioForm.classList.add('hidden');
                }

                const sortedAnuncios = [...(data.announcements || [])].sort((a, b) => b.createdAt - a.createdAt);

                anunciosListEl.innerHTML = sortedAnuncios.length === 0 
                    ? '<p class="text-gray-500 italic text-center mt-4">No hay anuncios en este momento.</p>' 
                    : sortedAnuncios.map(anuncio => {
                        const deleteButton = currentUserIsParroco 
                            ? `<button data-id="${anuncio.id}" class="delete-anuncio-btn text-sm text-red-500 hover:underline">Eliminar</button>` 
                            : '';
                        const date = new Date(anuncio.createdAt).toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });

                        return `
                            <div class="p-4 border border-gray-200 rounded-lg bg-white shadow">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-md text-blue-700">${anuncio.title}</h4>
                                    ${deleteButton}
                                </div>
                                <p class="text-sm text-gray-700 mt-2 whitespace-pre-wrap">${anuncio.content}</p>
                                <p class="text-xs text-gray-400 mt-3 text-right">Publicado por ${anuncio.createdBy} el ${date}</p>
                            </div>
                        `;
                }).join('');
            }

            // --- Event Listeners and other functions ---
            function init() {
                initFirebase();
                setInterval(updateClock, 1000);
                updateClock();
                renderCalendar();
                prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
                nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });
                todayBtn.addEventListener('click', () => { currentDate = new Date(); renderCalendar(); });
                calendarDaysEl.addEventListener('click', (e) => {
                    const dayCell = e.target.closest('.calendar-day');
                    if (dayCell && dayCell.dataset.date) {
                        // openDayModal(dayCell.dataset.date);
                    }
                });
                openDirectoryBtn.addEventListener('click', () => modalManager.open(document.getElementById('directory-modal'), openDirectoryBtn));
                openAgendaBtn.addEventListener('click', () => {
                    const manualModal = document.getElementById('manual-modal');
                    const agendaContent = document.getElementById('tab-content-agenda');
                    
                    // Lazy load content if it's not there
                    if(!agendaContent.innerHTML) {
                         agendaContent.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-3 gap-6 h-full"><div class="md:col-span-1 bg-white p-4 rounded-lg shadow-sm"><h4 id="agenda-form-title" class="text-lg font-semibold mb-4 text-gray-700">Añadir Evento</h4><form id="agenda-form" class="space-y-4"><input type="hidden" id="agenda-edit-id"><div><label for="agenda-date" class="block text-sm font-medium text-gray-600">Fecha y Hora</label><input type="datetime-local" id="agenda-date" class="form-input" required></div><div><label for="agenda-activity" class="block text-sm font-medium text-gray-600">Actividad</label><input type="text" id="agenda-activity" class="form-input" placeholder="Ej. Misa de Bodas" required></div><div><label for="agenda-place" class="block text-sm font-medium text-gray-600">Lugar</label><input type="text" id="agenda-place" class="form-input" placeholder="Ej. Templo principal"></div><div><label for="agenda-contact" class="block text-sm font-medium text-gray-600">Contacto (Nombre y Teléfono)</label><input type="text" id="agenda-contact" class="form-input" placeholder="Ej. Familia Pérez - 2281234567"></div><div><label for="agenda-notes" class="block text-sm font-medium text-gray-600">Notas Adicionales</label><textarea id="agenda-notes" rows="3" class="form-input" placeholder="Detalles, preparativos, etc."></textarea></div><div class="flex space-x-2"><button type="submit" id="agenda-submit-btn" class="btn btn-primary w-full">Guardar</button><button type="button" id="agenda-cancel-btn" class="btn btn-secondary w-full hidden">Cancelar</button></div></form></div><div class="md:col-span-2 bg-white p-4 rounded-lg shadow-sm flex flex-col"><h4 class="text-lg font-semibold mb-4 text-gray-700">Próximos Eventos</h4><div id="agenda-list" class="space-y-3 overflow-y-auto flex-grow"></div></div></div>`;
                    }

                    renderAgenda();
                    modalManager.open(manualModal, openAgendaBtn);
                    manualModal.querySelector('#manual-modal-title').textContent = 'Agenda Parroquial';
                    manualModal.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                    agendaContent.classList.add('active');
                });

                openAnunciosBtn.addEventListener('click', () => {
                    modalManager.open(document.getElementById('anuncios-modal'), openAnunciosBtn);
                });

                document.getElementById('add-anuncio-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const titleInput = document.getElementById('anuncio-title');
                    const contentInput = document.getElementById('anuncio-content');
                    const title = titleInput.value.trim();
                    const content = contentInput.value.trim();

                    if (title && content && currentUserIsParroco) {
                        try {
                            await addDoc(getCollectionRef('announcements'), {
                                title: title,
                                content: content,
                                createdBy: currentUser,
                                createdAt: Date.now()
                            });
                            titleInput.value = '';
                            contentInput.value = '';
                        } catch (error) {
                            console.error("Error adding announcement: ", error);
                            alert('Hubo un error al publicar el anuncio.');
                        }
                    }
                });

                document.getElementById('anuncios-list').addEventListener('click', async (e) => {
                    if (e.target.classList.contains('delete-anuncio-btn') && currentUserIsParroco) {
                        const anuncioId = e.target.dataset.id;
                        // Using a simple confirm dialog for now
                        const isConfirmed = await new Promise(resolve => {
                            const confirmModal = document.getElementById('confirm-modal');
                            document.getElementById('confirm-modal-text').textContent = '¿Estás seguro de que quieres eliminar este anuncio? Esta acción no se puede deshacer.';
                            modalManager.open(confirmModal);
                            document.getElementById('confirm-modal-confirm-btn').onclick = () => resolve(true);
                            document.getElementById('confirm-modal-cancel-btn').onclick = () => resolve(false);
                        }).finally(() => modalManager.close(document.getElementById('confirm-modal')));

                        if (isConfirmed) {
                            try {
                                await deleteDoc(getDocRef('announcements', anuncioId));
                            } catch (error) {
                                console.error("Error deleting announcement: ", error);
                                alert('Hubo un error al eliminar el anuncio.');
                            }
                        }
                    }
                });

                 openRevisionesBtn.addEventListener('click', () => {
                    const manualModal = document.getElementById('manual-modal');
                    const revisionesContent = document.getElementById('tab-content-revisiones');
                    
                    modalManager.open(manualModal, openRevisionesBtn);
                    manualModal.querySelector('#manual-modal-title').textContent = 'Revisiones';
                    manualModal.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                    revisionesContent.classList.add('active');
                });

                openHabilidadesBtn.addEventListener('click', () => {
                    const manualModal = document.getElementById('manual-modal');
                    const habilidadesContent = document.getElementById('tab-content-habilidades');
                    
                    modalManager.open(manualModal, openHabilidadesBtn);
                    manualModal.querySelector('#manual-modal-title').textContent = 'Habilidades';
                    manualModal.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                    habilidadesContent.classList.add('active');
                });

                openTareasBtn.addEventListener('click', () => {
                    modalManager.open(document.getElementById('add-task-modal'), openTareasBtn);
                });

                 // Add other nav button listeners here
            }
            
            init();
        });
    </script>
</body>
</html>